/**
* jquery.cashFormat.js
* @author: Egor Skorobogatov
* 
* @version: 1.1.0 - 2013-10-08
* Created by Egor Skorobogatov on 2013-10-08. Please report any bugs to https://github.com/git-decadent/cashFormat.js.git
* The MIT License (http://www.opensource.org/licenses/mit-license.php)
*/
(function(i){var a={},k={37:true,38:true,39:true,40:true},f={8:true,48:true,49:true,50:true,51:true,52:true,53:true,54:true,55:true,56:true,57:true,58:true},c=function c(m){if(m===""||m===undefined){return""}var l="",n=function(q){var p=q.length-1,r=q.split("").reverse(),o="";do{o+=r[p];if(p%3===0&&p!==0){o+=" "}p-=1}while(p>=0);return i.trim(o)};l+=n(m);return l},j=function(m){var n=0;if(document.selection){m.focus();var l=document.selection.createRange();l.moveStart("character",-m.value.length);n=l.text.length}else{if(m.selectionStart||m.selectionStart=="0"){n=m.selectionStart}}return(n)},e=function(n,l){if(n.setSelectionRange){n.setSelectionRange(l,l)}else{var m=n.createTextRange();m.collapse(true);m.moveStart("character",l);m.moveEnd("character",0);m.select()}},g=function(l){return l.replace(/\s/gi,"")},d=function(m){var l=m.match(/\s/gi);return(l!==null?l.length:0)},h={separator:"."};var b=function(l,m){this.$el=i(l);this.options=i.extend(h,m);this.$el.addClass("cash-input");this.init()};b.prototype.init=function(){var l=this,m=g(this.$el.val());if(m===""||m===null||m===undefined){m="0"+this.options.separator+"00"}else{m=m.replace(".",this.options.separator);if(m.search(this.options.separator)<0){m=c(m)+this.options.separator+"00"}else{m=c(m.split(this.options.separator)[0])+this.options.separator+m.split(this.options.separator)[1]}}this.$el.val(m);this.cacheVal=m;this.$el.on({keyup:function(n){l.handleKeyUp.call(l,n)},keydown:function(n){l.handleKeyDown.call(l,n)},blur:function(){l.handleChange.call(l)}})};b.prototype.handleChange=function(){var l,m;if(this.cacheVal!==null){m=this.cacheVal}else{m=this.$el.val()}l=m.split(this.options.separator);if(l.length===1){m+=this.options.separator+"00"}else{if(l[1].length<=1){m+=l[1].length===0?"00":"0"}}if(l[0]===""){m="0"+m}this.$el.val(m)};b.prototype.handleKeyDown=function(l){if(!f[l.keyCode]&&!k[l.keyCode]){l.preventDefault();return}if(this.cacheVal===null){this.cacheVal=this.$el.val()}this.spaces=d(this.cacheVal)};b.prototype.handleKeyUp=function(n){if(!f[n.keyCode]){return}var p=g(this.$el.val()),m=/(((^0(?=,|\.)|^[123456789])[\d]*)|^)[,\.]{1}([\d]{0,2})|[,\.]$/gi.exec(p),o=j(this.$el[0]),l;if(m===null){this.$el.val(this.cacheVal);l=-1}else{if(m[0]!==this.options.separator){this.$el.val(c(m[1])+this.options.separator+m[4])}else{this.$el.val(this.options.separator)}this.cacheVal=null;l=d(this.$el.val())-this.spaces}e(this.$el[0],o+l)};b.prototype.getValue=function(){return parseFloat(g(this.$el.val().replace(this.options.separator,".")),10)};i.fn.cashFormat=function(){var l=this,m=arguments;if(arguments.length===0||typeof arguments[0]!=="string"){i.each(this,function(n){a["cache_"+n]=new b(l[n],m.length===0?{}:m[0]);l[n].cid="cache_"+n})}else{if(typeof arguments[0]==="string"){i.each(this,function(n){a[l[n].cid][m[0]]()})}}return this}})(jQuery);