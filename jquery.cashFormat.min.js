/**
* jquery.cashFormat.js
* @author: Egor Skorobogatov
* 
* @version: 1.2.0 - 2013-16-08
* Created by Egor Skorobogatov on 2013-10-08. Please report any bugs to https://github.com/git-decadent/cashFormat.js.git
* The MIT License (http://www.opensource.org/licenses/mit-license.php)
*/
(function(j){var a={},e={9:true,17:true,91:true},m={65:true,67:true,86:true,88:true},l={37:true,38:true,39:true,40:true},g={8:true,48:true,49:true,50:true,51:true,52:true,53:true,54:true,55:true,56:true,57:true,58:true,96:true,97:true,98:true,99:true,100:true,101:true,102:true,103:true,104:true,105:true,188:true,190:true,44:true,46:true},c=function c(o){if(o===""||o===undefined){return""}var n="",p=function(s){var r=s.length-1,t=s.split("").reverse(),q="";do{q+=t[r];if(r%3===0&&r!==0){q+=" "}r-=1}while(r>=0);return j.trim(q)};n+=p(o);return n},k=function(o){var p=0;if(document.selection){o.focus();var n=document.selection.createRange();n.moveStart("character",-o.value.length);p=n.text.length}else{if(o.selectionStart||o.selectionStart=="0"){p=o.selectionStart}}return(p)},f=function(p,n){if(p.setSelectionRange){p.setSelectionRange(n,n)}else{var o=p.createTextRange();o.collapse(true);o.moveStart("character",n);o.moveEnd("character",0);o.select()}},h=function(n){return n.replace(/\s/gi,"")},d=function(o){var n=o.match(/\s/gi);return(n!==null?n.length:0)},i={separator:"."};var b=function(n,o){this.$el=j(n);this.options=j.extend(i,o);this.$el.addClass("cash-input");this.init()};b.prototype.init=function(){var n=this,o=h(this.$el.val());if(o===""||o===null||o===undefined){o="0"+this.options.separator+"00"}else{o=o.replace(".",this.options.separator);if(o.search(this.options.separator)<0){o=c(o)+this.options.separator+"00"}else{o=c(o.split(this.options.separator)[0])+this.options.separator+o.split(this.options.separator)[1]}}this.$el.val(o);this.cacheVal=o;this.$el.on({keyup:function(p){n.handleKeyUp.call(n,p)},keydown:function(p){n.handleKeyDown.call(n,p)},blur:function(){n.handleChange.call(n)}})};b.prototype.handleChange=function(){var n,o;if(this.cacheVal!==null){o=this.cacheVal}else{o=this.$el.val()}n=o.split(this.options.separator);if(n.length===1){o+=this.options.separator+"00"}else{if(n[1].length<=1){o+=n[1].length===0?"00":"0"}}if(n[0]===""){o="0"+o}this.$el.val(o)};b.prototype.checkCommand=function(n){if(e[n]){this.commandPressed=true;return true}if(m[n]&&this.commandPressed){return true}};b.prototype.handleKeyDown=function(n){if(!g[n.keyCode]&&!l[n.keyCode]){if(!this.checkCommand(n.keyCode)){n.preventDefault();return}}if(this.cacheVal===null){this.cacheVal=this.$el.val()}this.spaces=d(this.cacheVal)};b.prototype.handleKeyUp=function(p){if(e[p.keyCode]){this.commandPressed=false}if(!g[p.keyCode]){return}var s,o,r,n,q;s=h(this.$el.val());q=s.substr(0,1);o=/(((^0(?=,|\.)|^[123456789])[\d]*)|^)[,\.]{1}([\d]{0,2})|[,\.]$/gi.exec(s);r=k(this.$el[0]);if(o===null&&/^[\d]+$/gi.exec(s)===null&&/^\B$/gi.exec(s)===null){this.$el.val(this.cacheVal);n=-1}else{if(o===null&&/^[\d]+$/gi.exec(s)!==null){if(q==="0"&&/^[0]$/gi.exec(s)===null){s="0"}this.$el.val(c(s));this.cacheVal=null;n=d(this.$el.val())-this.spaces}else{if(o===null&&/^\B$/gi.exec(s)!==null){n=0}else{if(o[0]!==this.options.separator){this.$el.val(c(o[1])+this.options.separator+o[4])}else{this.$el.val(this.options.separator)}this.cacheVal=null;n=d(this.$el.val())-this.spaces}}}f(this.$el[0],r+n)};b.prototype.getValue=function(){return parseFloat(h(this.$el.val().replace(this.options.separator,".")),10)};j.fn.cashFormat=function(){var n=this,o=arguments;if(arguments.length===0||typeof arguments[0]!=="string"){j.each(this,function(p){a["cache_"+p]=new b(n[p],o.length===0?{}:o[0]);n[p].cid="cache_"+p})}else{if(typeof arguments[0]==="string"){j.each(this,function(p){a[n[p].cid][o[0]]()})}}return this}})(jQuery);